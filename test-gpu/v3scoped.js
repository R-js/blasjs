//Form  C := alpha*A*B + beta*C.
//Note result will be given back in C
//[test case5]/[trA="n", trB="n",s m=4,n=6, k=3, ld[x]=6, alpha=0.3, beta=-1.2]

const alpha = 0.3
const beta = -1.2
const lda=ldb=ldc=6

// B(K,N), A(M,K)
// A(M,K), C(M,N)
const m = 4
const n = 6
const k = 3

// 6x6 matrix, row-first A(i,j), but only the section (4,3) is used for A
const a = [
    1.2629542848807933,
    -0.3262333607056494,
    1.3297992629225006,
    1.2724293214294047,
    0.4146414344564082,
    -1.5399500419037095,
    -0.9285670347135381,
    -0.2947204467905602,
    -0.005767172747536955,
    2.404653388857951,
    0.7635934611404596,
    -0.7990092489893682,
    -1.1476570092363514,
    -0.28946157368822334,
    -0.29921511789731614,
    -0.411510832795067,
    0.2522234481561323,
    -0.8919211272845686,
    0.43568329935571865,
    -1.237538421929958,
    -0.22426788527830935,
    0.37739564598170106,
    0.1333363608148414,
    0.8041895097449078,
    -0.057106774383808755,
    0.5036079722337261,
    1.085769362145687,
    -0.6909538396968303,
    -1.2845993538721883,
    0.04672617218835198,
    -0.23570655643950122,
    -0.5428882550102544,
    -0.4333103174567822,
    -0.6494716467962331,
    0.726750747385451,
    1.1519117540872
];

// 6x6 matrix, row-first B(i,j), but only the section (3,6) is used for B  
const b = [
    1.2629542848807933,
    -0.3262333607056494,
    1.3297992629225006,
    1.2724293214294047,
    0.4146414344564082,
    -1.5399500419037095,
    -0.9285670347135381,
    -0.2947204467905602,
    -0.005767172747536955,
    2.404653388857951,
    0.7635934611404596,
    -0.7990092489893682,
    -1.1476570092363514,
    -0.28946157368822334,
    -0.29921511789731614,
    -0.411510832795067,
    0.2522234481561323,
    -0.8919211272845686,
    0.43568329935571865,
    -1.237538421929958,
    -0.22426788527830935,
    0.37739564598170106,
    0.1333363608148414,
    0.8041895097449078,
    -0.057106774383808755,
    0.5036079722337261,
    1.085769362145687,
    -0.6909538396968303,
    -1.2845993538721883,
    0.04672617218835198,
    -0.23570655643950122,
    -0.5428882550102544,
    -0.4333103174567822,
    -0.6494716467962331,
    0.726750747385451,
    1.1519117540872
];

// 6x6 matrix, row-first B(i,j), but only the section (4,6) is used for C  
const c = [
    1.2629542848807933,
    -0.3262333607056494,
    1.3297992629225006,
    1.2724293214294047,
    0.4146414344564082,
    -1.5399500419037095,
    -0.9285670347135381,
    -0.2947204467905602,
    -0.005767172747536955,
    2.404653388857951,
    0.7635934611404596,
    -0.7990092489893682,
    -1.1476570092363514,
    -0.28946157368822334,
    -0.29921511789731614,
    -0.411510832795067,
    0.2522234481561323,
    -0.8919211272845686,
    0.43568329935571865,
    -1.237538421929958,
    -0.22426788527830935,
    0.37739564598170106,
    0.1333363608148414,
    0.8041895097449078,
    -0.057106774383808755,
    0.5036079722337261,
    1.085769362145687,
    -0.6909538396968303,
    -1.2845993538721883,
    0.04672617218835198,
    -0.23570655643950122,
    -0.5428882550102544,
    -0.4333103174567822,
    -0.6494716467962331,
    0.726750747385451,
    1.1519117540872
];

// this is what C should be After the computation
const result = [
    -1.4039963092403844,
    0.18124124487022381,
    -1.2107208849353177,
    -1.4443207422595890,
    0.41464143991470337,
    -1.5399500131607056,
    0.84654511690969958,
    0.47110226605777850,
    -0.36249415168348781,
    -3.4519430694935669,
    0.76359343528747559,
    -0.79900926351547241,
    1.1260112382918237,
    0.51125157946674815,
    -7.1428211629562310E-002,
    -0.11615811188891931,
    0.25222346186637878,
    -0.89192110300064087,
    6.4210470875263270E-002,
    1.5712993271415543,
    0.46520531931755910,
    -1.1516306540304853,
    0.13333636522293091,
    0.80418950319290161,
    -0.46722627045877629,
    -0.73755420551909645,
    -1.4240404210621318,
    1.0366043860301484,
    -1.2845993041992188,
    4.6726170927286148E-002,
    0.49396185302075668,
    0.76016266322751813,
    0.46577487040588361,
    0.35124613688394185,
    0.72675073146820068,
    1.1519117355346680,
];

function runMe() {
    //colOfEx: (col) => (col - colBase) * lda - rowBase,
    for (let j = 1; j <= n; j++) {
        const coorCJ = (j - 1) * ldc - 1;
        const coorBJ = (j - 1) * ldb - 1;
        for (let i = 1; i <= m; i++) {
            c[coorCJ + i] *= beta;
        }

        for (let l = 1; l <= k; l++) {
            let temp = alpha * b[coorBJ + l];
            const coorAL = (l-1)*lda -1;
            for (let i = 1; i <= m; i++) {
                c[coorCJ + i] += temp * a[coorAL + i]
            }
        }
    }
    console.log(c)
}

runMe()

/*
const log = new MatrixLog('result', 6, 6);
function runMe() {
  //colOfEx: (col) => (col - colBase) * lda - rowBase,
  for (let j = 1; j <= n; j++) {
    const coorCJ = (j - 1) * ldc - 1;
    const coorBJ = (j - 1) * ldb - 1;
    for (let i = 1; i <= m; i++) {
      c[coorCJ + i] *= beta;
      log.at({ x: j - 1, y: i - 1});
      log.add({ name: 'c', x: j - 1, y: i - 1, width: 6, height: 6 });
    }

    for (let l = 1; l <= k; l++) {
      let temp = alpha * b[coorBJ + l];
      const coorAL = (l-1)*lda -1;
      for (let i = 1; i <= m; i++) {
        c[coorCJ + i] += temp * a[coorAL + i]
        log.at({ x: j - 1, y: i - 1 });
        log.add({ name: 'b', x: l - 1, y: j - 1, width: 6, height: 6 });
        log.add({ name: 'a', x: i - 1, y: l - 1, width: 6, height: 6 });
      }
    }
  }

  require('fs').writeFileSync('logs/a.log', log.toString('a'));
  require('fs').writeFileSync('logs/b.log', log.toString('b'));
  require('fs').writeFileSync('logs/c.log', log.toString('c'));
  console.log(c)
}
*/