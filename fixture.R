#> data = complex(real=rnorm(16), imaginary=rnorm(16))
#>> data
# [1] -0.4209720+0.8931618i -0.0506288-0.1393241i  0.1712773-0.5090373i -1.1261630+0.9376884i
# [5] -0.9446302+0.4809594i  0.4350762-0.6798474i  1.1376732+0.5828174i -0.9753698+1.2662274i
# [9]  1.1347980+1.0438244i  1.1299678+0.4221103i  1.6033854-1.3337606i -0.6119327+0.0123565i
# [13]  0.2018914+0.7217532i -0.9584058+0.0647572i  1.0895567-0.5057453i -1.3822117+0.4768580i

#> matrix(data=data, nrow=4, ncol=4)

#matrix:                      [,1]                  [,2]                  [,3]                  [,4]
#[1,] -0.4209720+0.8931618i -0.9446302+0.4809594i  1.1347980+1.0438244i  0.2018914+0.7217532i
#[2,] -0.0506288-0.1393241i  0.4350762-0.6798474i  1.1299678+0.4221103i -0.9584058+0.0647572i
#[3,]  0.1712773-0.5090373i  1.1376732+0.5828174i  1.6033854-1.3337606i  1.0895567-0.5057453i
#[4,] -1.1261630+0.9376884i -0.9753698+1.2662274i -0.6119327+0.0123565i -1.3822117+0.4768580i

> c[lower.tri(c)] = c[upper.tri(c)]
> c

#:matricx:C
                      [,1]                  [,2]               [,3]                  [,4]
[1,] -0.4209720+0.8931618i -0.9446302+0.4809594i 1.134798+1.043824i  0.2018914+0.7217532i
[2,] -0.9446302+0.4809594i  0.4350762-0.6798474i 1.129968+0.422110i -0.9584058+0.0647572i
[3,]  1.1347980+1.0438244i  0.2018914+0.7217532i 1.603385-1.333761i  1.0895567-0.5057453i
[4,]  1.1299678+0.4221103i -0.9584058+0.0647572i 1.089557-0.505745i -1.3822117+0.4768580i

#> a = matrix(complex(real=rnorm(8), imaginary = rnorm(8)), nrow=4, ncol=2)
#> a
#:matrix A
                      [,1]                [,2]
[1,] -0.7939294-1.4826152i  1.965057-0.312665i
[2,]  0.0044153+1.0705172i  1.719627+0.436114i
[3,]  0.5935871+0.0329470i -1.452431+0.368372i
[4,]  0.5640821+0.9536697i -0.912274-1.032309i

#> t(a) %*% (a)
#                    [,1]                [,2]
#[1,] -2.953849+3.478647i -2.887350-2.103881i
#[2,] -2.887350-2.103881i  8.271052+1.084526i

#> (a) %*% t(a)
#:matrix AA_T
                    [,1]                [,2]                [,3]                [,4]
[1,]  2.195865+1.125374i  5.099183-0.537140i -3.161350+0.271777i -1.149355-3.336773i
[2,]  5.099183-0.537140i  1.620936+1.509361i -2.690941+0.635628i -2.136997-1.564972i
[3,] -3.161350+0.271777i -2.690941+0.635628i  2.325117-1.030956i  2.008700+1.747972i
[4,] -1.149355-3.336773i -2.136997-1.564972i  2.008700+1.747972i -0.824714+2.959394i

#> (a %*% t(a)) + c
#                    [,1]                [,2]                [,3]                [,4]
#[1,]  1.774893+2.018536i  4.154553-0.056181i -2.026552+1.315602i -0.947463-2.615019i
#[2,]  4.154553-0.056181i  2.056012+0.829513i -1.560973+1.057738i -3.095403-1.500215i
#[3,] -2.026552+1.315602i -2.489050+1.357381i  3.928502-2.364716i  3.098257+1.242226i
#[4,] -0.019387-2.914662i -3.095403-1.500215i  3.098257+1.242226i -2.206926+3.436252i

# capture imaginary numbers in text 
#
# "-0.34234+0.6i".match(/^(?<real>-?(?:0|1)\.[0-9]+)(?<imag>(?:\+|\-)(?:0|1)\.[0-9]+)i$/)
#
# capture real numbers (non imaginary) in text
#
#> "-0.34234".match(/^(?<real>-?(?:0|1)\.[0-9]+)$/)
#[
#  '-0.34234',
#  '-0.34234',
#  index: 0,
#  input: '-0.34234',
#  groups: [Object: null prototype] { real: '-0.34234' }
#]

conjugate= function(a) { 
    x = dim(a)[1];
    y=dim(a)[2];
    Imag = Im(a);
    Real=Re(a);
    t(matrix(complex(real=Real, imaginary = -Imag), ncol=y, nrow=x));
}


// https://webassembly.github.io/wabt/demo/wat2wasm/
// https://www.assemblyscript.org/concepts.html

// https://www.assemblyscript.org/editor#IyFvcHRpbWl6ZT1zcGVlZCZydW50aW1lPWluY3JlbWVudGFsCi8qIFRoaXMgaXMgYSBjb252ZXJzaW9uIGZyb20gQkxBUyB0byBUeXBlc2NyaXB0L0phdmFzY3JpcHQNCkNvcHlyaWdodCAoQykgMjAxOCAgSmFjb2IgSy5GLiBCb2dlcnMgIGluZm9AbWFpbC5qYWNvYi1ib2dlcnMuY29tDQoNClRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5DQppdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uDQoNClRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUNCkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQoNCllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlDQphbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4NCiovDQovKg0KKj4gXHBhciBQdXJwb3NlOg0KKiAgPT09PT09PT09PT09PQ0KKj4NCio+IFx2ZXJiYXRpbQ0KKj4NCio+IENTWVJLICBwZXJmb3JtcyBvbmUgb2YgdGhlIHN5bW1ldHJpYyByYW5rIGsgb3BlcmF0aW9ucw0KKj4NCio+ICAgIEMgOj0gYWxwaGEqQSpBKipUICsgYmV0YSpDLA0KKj4NCio+IG9yDQoqPg0KKj4gICAgQyA6PSBhbHBoYSpBKipUKkEgKyBiZXRhKkMsDQoqPg0KKj4gd2hlcmUgIGFscGhhIGFuZCBiZXRhICBhcmUgc2NhbGFycywgIEMgaXMgYW4gIG4gYnkgbiBzeW1tZXRyaWMgbWF0cml4DQoqPiBhbmQgIEEgIGlzIGFuICBuIGJ5IGsgIG1hdHJpeCBpbiB0aGUgZmlyc3QgY2FzZSBhbmQgYSAgayBieSBuICBtYXRyaXgNCio+IGluIHRoZSBzZWNvbmQgY2FzZS4NCio+IFxlbmR2ZXJiYXRpbQ0KKg0KKiAgQXJndW1lbnRzOg0KKiAgPT09PT09PT09PQ0KKg0KKj4gXHBhcmFtW2luXSBVUExPDQoqPiBcdmVyYmF0aW0NCio+ICAgICAgICAgIFVQTE8gaXMgQ0hBUkFDVEVSKjENCio+ICAgICAgICAgICBPbiAgZW50cnksICAgVVBMTyAgc3BlY2lmaWVzICB3aGV0aGVyICB0aGUgIHVwcGVyICBvciAgbG93ZXINCio+ICAgICAgICAgICB0cmlhbmd1bGFyICBwYXJ0ICBvZiB0aGUgIGFycmF5ICBDICBpcyB0byBiZSAgcmVmZXJlbmNlZCAgYXMNCio+ICAgICAgICAgICBmb2xsb3dzOg0KKj4NCio+ICAgICAgICAgICAgICBVUExPID0gJ1UnIG9yICd1JyAgIE9ubHkgdGhlICB1cHBlciB0cmlhbmd1bGFyIHBhcnQgb2YgIEMNCio+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzIHRvIGJlIHJlZmVyZW5jZWQuDQoqPg0KKj4gICAgICAgICAgICAgIFVQTE8gPSAnTCcgb3IgJ2wnICAgT25seSB0aGUgIGxvd2VyIHRyaWFuZ3VsYXIgcGFydCBvZiAgQw0KKj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXMgdG8gYmUgcmVmZXJlbmNlZC4NCio+IFxlbmR2ZXJiYXRpbQ0KKj4NCio+IFxwYXJhbVtpbl0gVFJBTlMNCio+IFx2ZXJiYXRpbQ0KKj4gICAgICAgICAgVFJBTlMgaXMgQ0hBUkFDVEVSKjENCio+ICAgICAgICAgICBPbiBlbnRyeSwgIFRSQU5TICBzcGVjaWZpZXMgdGhlIG9wZXJhdGlvbiB0byBiZSBwZXJmb3JtZWQgYXMNCio+ICAgICAgICAgICBmb2xsb3dzOg0KKj4NCio+ICAgICAgICAgICAgICBUUkFOUyA9ICdOJyBvciAnbicgICBDIDo9IGFscGhhKkEqQSoqVCArIGJldGEqQy4NCio+DQoqPiAgICAgICAgICAgICAgVFJBTlMgPSAnVCcgb3IgJ3QnICAgQyA6PSBhbHBoYSpBKipUKkEgKyBiZXRhKkMuDQoqPiBcZW5kdmVyYmF0aW0NCio+DQoqPiBccGFyYW1baW5dIE4NCio+IFx2ZXJiYXRpbQ0KKj4gICAgICAgICAgTiBpcyBJTlRFR0VSDQoqPiAgICAgICAgICAgT24gZW50cnksICBOIHNwZWNpZmllcyB0aGUgb3JkZXIgb2YgdGhlIG1hdHJpeCBDLiAgTiBtdXN0IGJlDQoqPiAgICAgICAgICAgYXQgbGVhc3QgemVyby4NCio+IFxlbmR2ZXJiYXRpbQ0KKj4NCio+IFxwYXJhbVtpbl0gSw0KKj4gXHZlcmJhdGltDQoqPiAgICAgICAgICBLIGlzIElOVEVHRVINCio+ICAgICAgICAgICBPbiBlbnRyeSB3aXRoICBUUkFOUyA9ICdOJyBvciAnbicsICBLICBzcGVjaWZpZXMgIHRoZSBudW1iZXINCio+ICAgICAgICAgICBvZiAgY29sdW1ucyAgIG9mICB0aGUgICBtYXRyaXggICBBLCAgIGFuZCAgb24gICBlbnRyeSAgIHdpdGgNCio+ICAgICAgICAgICBUUkFOUyA9ICdUJyBvciAndCcsICBLICBzcGVjaWZpZXMgIHRoZSBudW1iZXIgb2Ygcm93cyBvZiB0aGUNCio+ICAgICAgICAgICBtYXRyaXggQS4gIEsgbXVzdCBiZSBhdCBsZWFzdCB6ZXJvLg0KKj4gXGVuZHZlcmJhdGltDQoqPg0KKj4gXHBhcmFtW2luXSBBTFBIQQ0KKj4gXHZlcmJhdGltDQoqPiAgICAgICAgICBBTFBIQSBpcyBDT01QTEVYDQoqPiAgICAgICAgICAgT24gZW50cnksIEFMUEhBIHNwZWNpZmllcyB0aGUgc2NhbGFyIGFscGhhLg0KKj4gXGVuZHZlcmJhdGltDQoqPg0KKj4gXHBhcmFtW2luXSBBDQoqPiBcdmVyYmF0aW0NCio+ICAgICAgICAgIEEgaXMgQ09NUExFWCBhcnJheSwgZGltZW5zaW9uICggTERBLCBrYSApLCB3aGVyZSBrYSBpcw0KKj4gICAgICAgICAgIGsgIHdoZW4gIFRSQU5TID0gJ04nIG9yICduJywgIGFuZCBpcyAgbiAgb3RoZXJ3aXNlLg0KKj4gICAgICAgICAgIEJlZm9yZSBlbnRyeSB3aXRoICBUUkFOUyA9ICdOJyBvciAnbicsICB0aGUgIGxlYWRpbmcgIG4gYnkgaw0KKj4gICAgICAgICAgIHBhcnQgb2YgdGhlIGFycmF5ICBBICBtdXN0IGNvbnRhaW4gdGhlIG1hdHJpeCAgQSwgIG90aGVyd2lzZQ0KKj4gICAgICAgICAgIHRoZSBsZWFkaW5nICBrIGJ5IG4gIHBhcnQgb2YgdGhlIGFycmF5ICBBICBtdXN0IGNvbnRhaW4gIHRoZQ0KKj4gICAgICAgICAgIG1hdHJpeCBBLg0KKj4gXGVuZHZlcmJhdGltDQoqPg0KKj4gXHBhcmFtW2luXSBMREENCio+IFx2ZXJiYXRpbQ0KKj4gICAgICAgICAgTERBIGlzIElOVEVHRVINCio+ICAgICAgICAgICBPbiBlbnRyeSwgTERBIHNwZWNpZmllcyB0aGUgZmlyc3QgZGltZW5zaW9uIG9mIEEgYXMgZGVjbGFyZWQNCio+ICAgICAgICAgICBpbiAgdGhlICBjYWxsaW5nICAoc3ViKSAgcHJvZ3JhbS4gICBXaGVuICBUUkFOUyA9ICdOJyBvciAnbicNCio+ICAgICAgICAgICB0aGVuICBMREEgbXVzdCBiZSBhdCBsZWFzdCAgbWF4KCAxLCBuICksIG90aGVyd2lzZSAgTERBIG11c3QNCio+ICAgICAgICAgICBiZSBhdCBsZWFzdCAgbWF4KCAxLCBrICkuDQoqPiBcZW5kdmVyYmF0aW0NCio+DQoqPiBccGFyYW1baW5dIEJFVEENCio+IFx2ZXJiYXRpbQ0KKj4gICAgICAgICAgQkVUQSBpcyBDT01QTEVYDQoqPiAgICAgICAgICAgT24gZW50cnksIEJFVEEgc3BlY2lmaWVzIHRoZSBzY2FsYXIgYmV0YS4NCio+IFxlbmR2ZXJiYXRpbQ0KKj4NCio+IFxwYXJhbVtpbixvdXRdIEMNCio+IFx2ZXJiYXRpbQ0KKj4gICAgICAgICAgQyBpcyBDT01QTEVYIGFycmF5LCBkaW1lbnNpb24gKCBMREMsIE4gKQ0KKj4gICAgICAgICAgIEJlZm9yZSBlbnRyeSAgd2l0aCAgVVBMTyA9ICdVJyBvciAndScsICB0aGUgbGVhZGluZyAgbiBieSBuDQoqPiAgICAgICAgICAgdXBwZXIgdHJpYW5ndWxhciBwYXJ0IG9mIHRoZSBhcnJheSBDIG11c3QgY29udGFpbiB0aGUgdXBwZXINCio+ICAgICAgICAgICB0cmlhbmd1bGFyIHBhcnQgIG9mIHRoZSAgc3ltbWV0cmljIG1hdHJpeCAgYW5kIHRoZSBzdHJpY3RseQ0KKj4gICAgICAgICAgIGxvd2VyIHRyaWFuZ3VsYXIgcGFydCBvZiBDIGlzIG5vdCByZWZlcmVuY2VkLiAgT24gZXhpdCwgdGhlDQoqPiAgICAgICAgICAgdXBwZXIgdHJpYW5ndWxhciBwYXJ0IG9mIHRoZSBhcnJheSAgQyBpcyBvdmVyd3JpdHRlbiBieSB0aGUNCio+ICAgICAgICAgICB1cHBlciB0cmlhbmd1bGFyIHBhcnQgb2YgdGhlIHVwZGF0ZWQgbWF0cml4Lg0KKj4gICAgICAgICAgIEJlZm9yZSBlbnRyeSAgd2l0aCAgVVBMTyA9ICdMJyBvciAnbCcsICB0aGUgbGVhZGluZyAgbiBieSBuDQoqPiAgICAgICAgICAgbG93ZXIgdHJpYW5ndWxhciBwYXJ0IG9mIHRoZSBhcnJheSBDIG11c3QgY29udGFpbiB0aGUgbG93ZXINCio+ICAgICAgICAgICB0cmlhbmd1bGFyIHBhcnQgIG9mIHRoZSAgc3ltbWV0cmljIG1hdHJpeCAgYW5kIHRoZSBzdHJpY3RseQ0KKj4gICAgICAgICAgIHVwcGVyIHRyaWFuZ3VsYXIgcGFydCBvZiBDIGlzIG5vdCByZWZlcmVuY2VkLiAgT24gZXhpdCwgdGhlDQoqPiAgICAgICAgICAgbG93ZXIgdHJpYW5ndWxhciBwYXJ0IG9mIHRoZSBhcnJheSAgQyBpcyBvdmVyd3JpdHRlbiBieSB0aGUNCio+ICAgICAgICAgICBsb3dlciB0cmlhbmd1bGFyIHBhcnQgb2YgdGhlIHVwZGF0ZWQgbWF0cml4Lg0KKj4gXGVuZHZlcmJhdGltDQoqPg0KKj4gXHBhcmFtW2luXSBMREMNCio+IFx2ZXJiYXRpbQ0KKj4gICAgICAgICAgTERDIGlzIElOVEVHRVINCio+ICAgICAgICAgICBPbiBlbnRyeSwgTERDIHNwZWNpZmllcyB0aGUgZmlyc3QgZGltZW5zaW9uIG9mIEMgYXMgZGVjbGFyZWQNCio+ICAgICAgICAgICBpbiAgdGhlICBjYWxsaW5nICAoc3ViKSAgcHJvZ3JhbS4gICBMREMgIG11c3QgIGJlICBhdCAgbGVhc3QNCio+ICAgICAgICAgICBtYXgoIDEsIG4gKS4NCio+IFxlbmR2ZXJiYXRpbQ0KKg0KKiAgQXV0aG9yczoNCiogID09PT09PT09DQoqDQoqPiBcYXV0aG9yIFVuaXYuIG9mIFRlbm5lc3NlZQ0KKj4gXGF1dGhvciBVbml2LiBvZiBDYWxpZm9ybmlhIEJlcmtlbGV5DQoqPiBcYXV0aG9yIFVuaXYuIG9mIENvbG9yYWRvIERlbnZlcg0KKj4gXGF1dGhvciBOQUcgTHRkLg0KKg0KKj4gXGRhdGUgRGVjZW1iZXIgMjAxNg0KKg0KKj4gXGluZ3JvdXAgY29tcGxleF9ibGFzX2xldmVsMw0KKg0KKj4gXHBhciBGdXJ0aGVyIERldGFpbHM6DQoqICA9PT09PT09PT09PT09PT09PT09PT0NCio+DQoqPiBcdmVyYmF0aW0NCio+DQoqPiAgTGV2ZWwgMyBCbGFzIHJvdXRpbmUuDQoqPg0KKj4gIC0tIFdyaXR0ZW4gb24gOC1GZWJydWFyeS0xOTg5Lg0KKj4gICAgIEphY2sgRG9uZ2FycmEsIEFyZ29ubmUgTmF0aW9uYWwgTGFib3JhdG9yeS4NCio+ICAgICBJYWluIER1ZmYsIEFFUkUgSGFyd2VsbC4NCio+ICAgICBKZXJlbXkgRHUgQ3JveiwgTnVtZXJpY2FsIEFsZ29yaXRobXMgR3JvdXAgTHRkLg0KKj4gICAgIFN2ZW4gSGFtbWFybGluZywgTnVtZXJpY2FsIEFsZ29yaXRobXMgR3JvdXAgTHRkLg0KKj4gXGVuZHZlcmJhdGltDQoqLw0KDQovLyBtdWx0aXRocmVhZGVkIGRvZXMgbm90IGV4aXN0IGluIGphdmFzY3JpcHQgYW5kIHRoaXMgYXZvaWRzIGNyZWF0aW5nIGEgbmV3IEZsb2F0QXJyYXkgDQoNCmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNzeXJrKA0KICAgIHVwcGVyOiBpMzIsDQogICAgdHJhbnNQb3NlOiBpMzIsDQogICAgbjogaTMyLA0KICAgIGs6IGkzMiwNCiAgICBhbHBoYTogU3RhdGljQXJyYXk8ZjY0PiwNCiAgICBhOiBTdGF0aWNBcnJheTxmNjQ+LA0KICAgIGJldGE6IFN0YXRpY0FycmF5PGY2ND4sDQogICAgYzogU3RhdGljQXJyYXk8ZjY0PiwNCiAgICBpc1BhY2tlZDogaTMyDQopOiB2b2lkIHsNCiAgICBjb25zdCBhbHBoYUlzWmVybyA9IGFscGhhWzBdID09PSAwICYmIGFscGhhWzFdID09PSAwOw0KICAgIGNvbnN0IGJldGFJc09uZSA9IGJldGFbMF0gPT09IDEgJiYgYmV0YVsxXSA9PT0gMDsNCiAgICBjb25zdCBiZXRhSXNaZXJvID0gYmV0YVswXSA9PT0gMCAmJiBiZXRhWzFdID09PSAwOw0KICAgIGNvbnN0IE5OID0gbiAqIDI7DQogICAgY29uc3QgS0sgPSBrICogMjsNCg0KICAgIC8vICBRdWljayByZXR1cm4gaWYgcG9zc2libGUuDQogICAgaWYgKG4gPT09IDAgfHwgKChhbHBoYUlzWmVybyB8fCBrID09PSAwKSAmJiBiZXRhSXNPbmUpKSByZXR1cm47DQoNCiAgICAvLyAgQW5kIHdoZW4gIGFscGhhLmVxLnplcm8uDQogICAgbGV0IHBhY2tDdXJzb3IgPSAwOw0KICAgIGlmIChhbHBoYUlzWmVybykgew0KICAgICAgICAvLyBjb2x1bW4gbWFqb3IgbWF0cml4IGxheW91dA0KICAgICAgICBmb3IgKGxldCBqID0gMCwgY29sQmFzZSA9IDA7IGogPCBuOyBqKyssIGNvbEJhc2UgKz0gTk4pIHsgLy8gaiA9IGNvbHVtbiBpbmRleA0KICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSB1cHBlciA/IGNvbEJhc2UgOiBjb2xCYXNlICsgKGogPDwgMSk7IC8vIGNvbXBsZXggbnVtYmVycyB0YWtlIDIgcG9zaXRpb25zIHNvICJuIiBpcyBoYWxmIGEgY29sdW1uIGhlaWdodA0KICAgICAgICAgICAgY29uc3Qgc3RvcCA9IHVwcGVyID8gY29sQmFzZSArICgoaiArIDEpIDw8IDEpIDogY29sQmFzZSArIE5OOyAvLyBleGNsdXNpdmUgZW5kIHBvc2l0aW9uICwgbm90ZSBhZ2FpbiwgY29tcGxleCBudW1iZXJzIHRha2UgMiBwb3NpdGlvbnMNCiAgICAgICAgICAgIGlmIChiZXRhSXNaZXJvKSB7DQogICAgICAgICAgICAgICAgaWYgKGlzUGFja2VkKXsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVuID0gc3RvcCAtIHN0YXJ0Ow0KICAgICAgICAgICAgICAgICAgICBjLmZpbGwoMCwgcGFja0N1cnNvciwgcGFja0N1cnNvciArIGxlbik7DQogICAgICAgICAgICAgICAgICAgIHBhY2tDdXJzb3IgKz0gbGVuOw0KICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjLmZpbGwoMCwgc3RhcnQsIHN0b3ApOw0KICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IHN0b3A7IGkgKz0gMiwgcGFja0N1cnNvciArPSAyKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkeCA9IGlzUGFja2VkID8gcGFja0N1cnNvciA6IGk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlID0gYmV0YVswXSAqIGNbaWR4XSAtIGJldGFbMV0gKiBjW2lkeCArIDFdOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBpbSA9IGJldGFbMF0gKiBjW2lkeF0gKyBiZXRhWzFdICogY1tpZHggKyAxXTsNCiAgICAgICAgICAgICAgICAgICAgY1tpZHhdID0gcmU7DQogICAgICAgICAgICAgICAgICAgIGNbaWR4ICsgMV0gPSBpbTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vIFN0YXJ0IHRoZSBvcGVyYXRpb25zLg0KICAgIGlmICh0cmFuc1Bvc2UgPT09IGZhbHNlKSB7DQogICAgICAgIC8vIEZvcm0gIEMgOj0gYWxwaGEqQSpBKipUICsgYmV0YSpDLg0KICAgICAgICAvLyBqIGlzIHRoZSBqdGggY29sdW1uIG9mIG1hdHJpeCBDDQogICAgICAgIGZvciAobGV0IGogPSAwLCBjb2xCYXNlQyA9IDA7IGogPCBuOyBqKyssIGNvbEJhc2VDICs9IE5OKSB7DQogICAgICAgICAgICBjb25zdCBwYWNrU3RhcnQgPSBwYWNrQ3Vyc29yOw0KICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSB1cHBlciA/IGNvbEJhc2VDIDogY29sQmFzZUMgKyAoaiA8PCAxKTsgLy8gY29tcGxleCBudW1iZXJzIHRha2UgMiBwb3NpdGlvbnMgc28gIm4iIGlzIGhhbGYgYSBjb2x1bW4gaGVpZ2h0DQogICAgICAgICAgICBjb25zdCBzdG9wID0gdXBwZXIgPyBjb2xCYXNlQyArICgoaiArIDEpIDw8IDEpIDogY29sQmFzZUMgKyBOTjsgLy8gZXhjbHVzaXZlIGVuZCBwb3NpdGlvbiAsIG5vdGUgYWdhaW4sIGNvbXBsZXggbnVtYmVycyB0YWtlIDIgcG9zaXRpb25zDQogICAgICAgICAgICBpZiAoYmV0YUlzWmVybykgew0KICAgICAgICAgICAgICAgIC8vIGNsZWFyIG91dCBtYXRyaXggQyB0byBkbyBsYXRlciBDIDo9IGFscGhhKkEqQSoqVCANCiAgICAgICAgICAgICAgICBpZiAoaXNQYWNrZWQpew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBsZW4gPSBzdG9wIC0gc3RhcnQ7DQogICAgICAgICAgICAgICAgICAgIGMuZmlsbCgwLCBwYWNrQ3Vyc29yLCBwYWNrQ3Vyc29yICsgbGVuKTsNCiAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYy5maWxsKDAsIHN0YXJ0LCBzdG9wKTsNCiAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8gYWthIEMgOj0gYWxwaGEqQSpBKipUICsgYmV0YSpDLCANCiAgICAgICAgICAgIGVsc2UgaWYgKCFiZXRhSXNPbmUpIHsNCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBzdG9wOyBpICs9IDIsIHBhY2tDdXJzb3IgKz0gMikgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBpZHggPSBpc1BhY2tlZCA/IHBhY2tDdXJzb3IgOiBpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCByZSA9IGJldGFbMF0gKiBjW2lkeF0gLSBiZXRhWzFdICogY1tpZHggKyAxXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW0gPSBiZXRhWzBdICogY1tpZHggKyAxXSArIGJldGFbMV0gKiBjW2lkeF07DQogICAgICAgICAgICAgICAgICAgIGNbaWR4XSA9IHJlOw0KICAgICAgICAgICAgICAgICAgICBjW2lkeCArIDFdID0gaW07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIGF0IHRoaXMgcG9pbnQgeW91IHdhbnQgdG8gZG8gIEMgKz0gYWxwaGEqQSpBKipUDQogICAgICAgICAgICAvLyBBIGhhcyAiayIgY29sdW1ucyBhbmQgIm4iIHJvd3MNCiAgICAgICAgICAgIHBhY2tDdXJzb3IgPSBwYWNrU3RhcnQ7IC8vIHJld2luZA0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgc3RvcDsgaSArPSAyLCBwYWNrQ3Vyc29yICs9IDIpIHsNCiAgICAgICAgICAgICAgICAvLyBiZWNhdXNlIG9mIHRyYW5zcG9zZSBzeW1tZXRyeSB3ZSBvbmx5IGxvb3Agb3ZlciBbMS4ua10NCiAgICAgICAgICAgICAgICBsZXQgbWF0cml4QVN0YXJ0ID0gaSAlIE5OOyAvLyB3ZSBkb250IGRldmlkZSBieSAyIGJlY2F1c2UgQSBpcyBhbHNvIGNvbXBsZXgsIGJvdGggaSBhbmQgTk4gdGFrZSBhcmUgdmFycyBpbiB0aGUgc3BhY2Ugb2YgdGhlIGNvbXBsZXggbWF0cml4IEMNCiAgICAgICAgICAgICAgICAvLyB0aGUgY29sdW1uIGluIEMgaXMgdGhlIGNvbHVtbiBpbiBBIHRyYW5zcG9zZSB3aXRoIGlzIHRoZSByb3cgaW4gQQ0KICAgICAgICAgICAgICAgIGxldCBtYXRyaXhBVFN0YXJ0ID0gaiA8PCAxOw0KICAgICAgICAgICAgICAgIGxldCB0ZW1wUmUgPSAwOw0KICAgICAgICAgICAgICAgIGxldCB0ZW1wSW0gPSAwOw0KICAgICAgICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsIDwgazsgbCsrLCBtYXRyaXhBU3RhcnQgKz0gTk4sIG1hdHJpeEFUU3RhcnQgKz0gTk4pIHsNCiAgICAgICAgICAgICAgICAgICAgdGVtcFJlICs9IGFbbWF0cml4QVN0YXJ0XSAqIGFbbWF0cml4QVRTdGFydF0gLSBhW21hdHJpeEFTdGFydCArIDFdICogYVttYXRyaXhBVFN0YXJ0ICsgMV07DQogICAgICAgICAgICAgICAgICAgIHRlbXBJbSArPSBhW21hdHJpeEFTdGFydF0gKiBhW21hdHJpeEFUU3RhcnQgKyAxXSArIGFbbWF0cml4QVN0YXJ0ICsgMV0gKiBhW21hdHJpeEFUU3RhcnRdDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnN0IGlkeCA9IGlzUGFja2VkID8gcGFja0N1cnNvciA6IGk7DQogICAgICAgICAgICAgICAgY1tpZHhdICs9IGFscGhhWzBdICogdGVtcFJlIC0gYWxwaGFbMV0gKiB0ZW1wSW07DQogICAgICAgICAgICAgICAgY1tpZHggKyAxXSArPSBhbHBoYVswXSAqIHRlbXBJbSArIGFscGhhWzFdICogdGVtcFJlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gIEZvcm0gIEMgOj0gYWxwaGEqQSoqVCpBICsgYmV0YSpDLg0KICAgICAgICAvLyB1c2UgTWF0cml4IEMgKG54biBhcyBhIGd1aWRlKSwgbGV0IGl0IG1vdmUgaW4gc3luYyB3aXRoIChuKSBjb2x1bW5zIG9mIEEqKlQNCiAgICAgICAgZm9yIChsZXQgaiA9IDAsIGNvbEJhc2VDID0gMCwgY29sQmFzZUFfVCA9IDA7IGogPCBuOyBqKyssIGNvbEJhc2VDICs9IE5OLCBjb2xCYXNlQV9UICs9IEtLKSB7DQogICAgICAgICAgICBjb25zdCBzdGFydCA9IHVwcGVyID8gY29sQmFzZUMgOiBjb2xCYXNlQyArIChqIDw8IDEpOyAvLyBjb21wbGV4IG51bWJlcnMgdGFrZSAyIHBvc2l0aW9ucyBzbyAibiIgaXMgaGFsZiBhIGNvbHVtbiBoZWlnaHQNCiAgICAgICAgICAgIGNvbnN0IHN0b3AgPSB1cHBlciA/IGNvbEJhc2VDICsgKChqICsgMSkgPDwgMSkgOiBjb2xCYXNlQyArIE5OOyAvLyBleGNsdXNpdmUgZW5kIHBvc2l0aW9uICwgbm90ZSBhZ2FpbiwgY29tcGxleCBudW1iZXJzIHRha2UgMiBwb3NpdGlvbnMNCiAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGFydCwgcm93QmFzZUFfVCA9IChzdGFydCAlIE5OKSAqIGs7IGkgPCBzdG9wOyBpICs9IDIsIHJvd0Jhc2VBX1QgKz0gS0ssIHBhY2tDdXJzb3IrPTIpIHsNCiAgICAgICAgICAgICAgICAvLyByb3cgaW4gQyA9IGkgJSBOTjsNCiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIHRoZSBjb2x1bW4gaW4gQVQgYmVjYXVzZSByb3ctbWFqb3INCiAgICAgICAgICAgICAgICAvLyBzbyAoaSAlIE5OKSAqIEtLLCANCiAgICAgICAgICAgICAgICAvLw0KICAgICAgICAgICAgICAgIC8vIGNvbCBpbiBDID0gag0KICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgYWxzbyB0aGUgY29sdW1uIGluIEFfVCAoc3RvcmVkIHJvdyBtYWpvcikNCiAgICAgICAgICAgICAgICBsZXQgdGVtcFJlID0gMDsNCiAgICAgICAgICAgICAgICBsZXQgdGVtcEltID0gMDsNCiAgICAgICAgICAgICAgICBmb3IgKGxldCBsID0gMDsgbCA8IEtLOyBsICs9IDIpIHsNCiAgICAgICAgICAgICAgICAgICAgdGVtcFJlICs9IGFbY29sQmFzZUFfVCArIGxdICogYVtyb3dCYXNlQV9UICsgbF0gLSBhW2NvbEJhc2VBX1QgKyBsICsgMV0gKiBhW3Jvd0Jhc2VBX1QgKyBsICsgMV07DQogICAgICAgICAgICAgICAgICAgIHRlbXBJbSArPSBhW2NvbEJhc2VBX1QgKyBsXSAqIGFbcm93QmFzZUFfVCArIGwgKyAxXSArIGFbY29sQmFzZUFfVCArIGwgKyAxXSAqIGFbcm93QmFzZUFfVCArIGxdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvL211bHRpcGx5IHdpdGggYWxwaGENCiAgICAgICAgICAgICAgICBsZXQgcmUgPSBhbHBoYVswXSAqIHRlbXBSZSAtIGFscGhhWzFdICogdGVtcEltOw0KICAgICAgICAgICAgICAgIGxldCBpbSA9IGFscGhhWzBdICogdGVtcEltICsgYWxwaGFbMV0gKiB0ZW1wUmU7DQogICAgICAgICAgICAgICAgY29uc3QgaWR4ID0gaXNQYWNrZWQgPyBwYWNrQ3Vyc29yIDogaTsNCiAgICAgICAgICAgICAgICBpZiAoIWJldGFJc1plcm8pIHsNCiAgICAgICAgICAgICAgICAgICAgcmUgKz0gYmV0YVswXSAqIGNbaWR4XSAtIGJldGFbMV0gKiBjW2lkeCArIDFdOw0KICAgICAgICAgICAgICAgICAgICBpbSArPSBiZXRhWzBdICogY1tpZHggKyAxXSArIGJldGFbMV0gKiBjW2lkeF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNbaWR4XSA9IHJlOw0KICAgICAgICAgICAgICAgIGNbaWR4ICsgMV0gPSBpbQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQojIWh0bWwK